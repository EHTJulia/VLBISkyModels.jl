<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Model Interface · VLBISkyModels.jl</title><meta name="title" content="Model Interface · VLBISkyModels.jl"/><meta property="og:title" content="Model Interface · VLBISkyModels.jl"/><meta property="twitter:title" content="Model Interface · VLBISkyModels.jl"/><meta name="description" content="Documentation for VLBISkyModels.jl."/><meta property="og:description" content="Documentation for VLBISkyModels.jl."/><meta property="twitter:description" content="Documentation for VLBISkyModels.jl."/><meta property="og:url" content="https://ehtjulia.github.io/VLBISkyModels.jl/interface/"/><meta property="twitter:url" content="https://ehtjulia.github.io/VLBISkyModels.jl/interface/"/><link rel="canonical" href="https://ehtjulia.github.io/VLBISkyModels.jl/interface/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">VLBISkyModels.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li class="is-active"><a class="tocitem" href>Model Interface</a><ul class="internal"><li><a class="tocitem" href="#Defining-the-Model"><span>Defining the Model</span></a></li><li><a class="tocitem" href="#Making-the-model-frequency-dependent"><span>Making the model frequency dependent</span></a></li></ul></li><li><a class="tocitem" href="../api/">API</a></li><li><a class="tocitem" href="../base_api/">Base API</a></li><li><a class="tocitem" href="../examples/nonanalytic/">Non-Analytic Modeling</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Model Interface</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Model Interface</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/EHTJulia/VLBISkyModels.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/EHTJulia/VLBISkyModels.jl/blob/main/docs/src/interface.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Model-Interface"><a class="docs-heading-anchor" href="#Model-Interface">Model Interface</a><a id="Model-Interface-1"></a><a class="docs-heading-anchor-permalink" href="#Model-Interface" title="Permalink"></a></h1><h2 id="Defining-the-Model"><a class="docs-heading-anchor" href="#Defining-the-Model">Defining the Model</a><a id="Defining-the-Model-1"></a><a class="docs-heading-anchor-permalink" href="#Defining-the-Model" title="Permalink"></a></h2><p><code>VLBISkyModels</code> aims to be more modular and extensible than previous VLBI modeling packages. Namely, simple models are composed to construct complicated source morphologies instead of making many different models. This is accomplished with a type and trait-based hierarchy.</p><p>Additionally, <a href="https://github.com/ptiede/ComradeBase.jl"><code>ComradeBase</code></a> is a low-dependency version of this package that defines this type and trait hierarchy that users can more easily incorporate into their packages.</p><p>To see how this works, we will go through a simplified implementation of the Gaussian model in <code>VLBISkyModels</code>. The Gaussian model is a simple, compact emission structure model that can constrain the typical characteristic size of an image feature from VLBI data. To construct a Gaussian model, we will first define a struct:</p><pre><code class="language-julia hljs">struct MyGaussian{T} &lt;: VLBISkyModels.AbstractModel
    size::T
end</code></pre><p>where <code>size</code> is the standard deviation of the gaussian.</p><div class="admonition is-info" id="Note-db9e4df1267bec5d"><header class="admonition-header">Note<a class="admonition-anchor" href="#Note-db9e4df1267bec5d" title="Permalink"></a></header><div class="admonition-body"><p>We typically do not include a <code>size</code> field in the model because a generic <code>size</code> can be specified with the <a href="../api/#VLBISkyModels.modify"><code>modify</code></a> function. However, for the sake of this example, we will include it, since it will highlight how to make models frequency dependent.</p></div></div><p>To specify the model we need to tell <code>VLBISkyModels</code> how we will represent the model in the image and visibility domain. For a Gaussian, both the image and visibilty domain are analytic. These are specified with the traits <a href="../base_api/#ComradeBase.visanalytic"><code>ComradeBase.visanalytic</code></a> and <a href="../base_api/#ComradeBase.imanalytic"><code>ComradeBase.imanalytic</code></a>:</p><pre><code class="language-julia hljs"># Fourier and image domains are analytic
ComradeBase.visanalytic(::Type{&lt;:MyGaussian}) = IsAnalytic()
ComradeBase.imanalytic(::Type{&lt;:MyGaussian}) = IsAnalytic()</code></pre><p>Finally, we can specify if the model is intrinsically polarized by using the <code>IsPolarized</code> and <code>NotPolarized()</code> trait</p><pre><code class="language-julia hljs">VLBISkyModels.ispolarized(::Type{&lt;:MyGaussian}) = NotPolarized()</code></pre><div class="admonition is-info" id="Note-2bc25d15e4cfb58f"><header class="admonition-header">Note<a class="admonition-anchor" href="#Note-2bc25d15e4cfb58f" title="Permalink"></a></header><div class="admonition-body"><p>The actual implementation defines the Gaussian to be a subtype of <code>VLBISkyModels.GeometricModel</code>, which automatically defines these methods. However, for models that aren&#39;t a subtype of <code>GeometricModel</code>, we assume the image domain <code>IsAnalytic()</code> and the Fourier domain is <code>NotAnalytic()</code>.</p></div></div><p>Since both the image and visibility domain representation of the Gaussian are analytic, we need to define an <code>intensity_point</code> and <code>visibility_point</code> method.</p><pre><code class="language-julia hljs">function ComradeBase.intensity_point(m::MyGaussian, p)
    (; X, Y) = p
    @unpack_params size = m(p)
    return exp(-(X^2 + Y^2) * inv(2 * size^2)) * inv(2π * size)
end

function ComradeBase.visibility_point(m::MyGaussian, p) where {T}
    @unpack_params size = m(p)
    return exp(-2π^2 * size^2 * (u^2 + v^2)) + 0im
end</code></pre><p>Note that as of <strong>0.6.6</strong> we recommend retrieving the parameters of the model <code>m</code> using either <a href="../api/#VLBISkyModels.getparam"><code>getparam</code></a> or the convience macro <a href="../api/#VLBISkyModels.@unpack_params"><code>@unpack_params</code></a>. This is because the parameters of the model may not be simple numbers but functions of time and frequency. Finally, not that <code>@unpack_params</code> is a macro that reduces boiler plate and is equivalent to,</p><pre><code class="language-julia hljs">size = getparam(m, :size, p) # identical to @unpack_params size = m(p)</code></pre><p>Additionally, most models in <code>VLBISkyModels</code> has two additional functions one can implement if possible:</p><ol><li><code>flux(m::MyGaussian)</code>: This defines the flux of a model. If this isn&#39;t defined, the model won&#39;t have a flux until an image is created. For a Gaussian, the definition is <code>flux(::MyGaussian) = 1.0</code>.</li><li><code>radialextent(::MyGaussian)</code>: This defines the model&#39;s default radial extent. For a Gaussian, we will consider the radial extent to be <span>$5σ$</span>, so <code>radialextent(m::MyGaussian) = 5.0*m.size</code>. Although note that for a frequency dependent Gaussian this will not work correctly.</li></ol><p>This completely defines the model interface for <code>VLBISkyModels</code>. With this, you can call the usual user API to evaluate, fit, and plot the model. Additionally, we can start talking about adding multiple Gaussians and modifying them. For instance, with a flux of 2 Jy. This can be created by <code>VLBISkyModels</code> as follows:</p><pre><code class="language-julia hljs">using Plots
gauss = 2.0 * MyGaussian(1.0)
fig = plot(gauss; layout=(1, 2), size=(800, 300))
plot!(fig[2], ellgauss; size=(800, 350))</code></pre><p><img src="../gauss.png" alt="Image"/></p><pre><code class="language-julia hljs">using Plots
u = rand(100) * 0.5;
v = rand(100) * 0.5;
vg = visibilitymap(gauss, u, v)
veg = visibilitymap(ellgauss, u, v)

Plots.scatter(hypot.(u, v), abs.(vg); label=&quot;Gaussian&quot;)
Plots.scatter!(hypot.(u, v), abs.(veg); label=&quot;Elliptical Gaussian&quot;)</code></pre><p><img src="../vis.png" alt="Image"/></p><h2 id="Making-the-model-frequency-dependent"><a class="docs-heading-anchor" href="#Making-the-model-frequency-dependent">Making the model frequency dependent</a><a id="Making-the-model-frequency-dependent-1"></a><a class="docs-heading-anchor-permalink" href="#Making-the-model-frequency-dependent" title="Permalink"></a></h2><p>To make the model frequency dependent we can use the existing <a href="../api/#VLBISkyModels.DomainParams"><code>VLBISkyModels.DomainParams</code></a> interface. This defines how the model parameters behave as a function of frequency and time. For example, to make the size of the Gaussian frequency dependent we can use the <a href="../api/#VLBISkyModels.TaylorSpectral"><code>TaylorSpectral</code></a> type</p><pre><code class="language-julia hljs">ν₀ = 230e9
σ₀ = 1.0
a = 1.0
size = TaylorSpectral(σ₀, a, ν₀)
gauss = MyGaussian(size)
ellgauss = 2.0 * MyGaussian(size)</code></pre><p>which will make a Gaussian whose size as a function of frequency is given by</p><p class="math-container">\[\sigma(\nu) = \sigma_0 (\nu / \nu_0)^a\]</p><p>If we wanted a different function form for the frequency dependence, we can define a new type</p><pre><code class="language-julia hljs">struct MyFreq{T,F} &lt;: VLBISkyModels.DomainParams
    a::T
    F0::F
end</code></pre><p>which only requires a single method to be defined for it to work</p><pre><code class="language-julia hljs">function VLBISkyModels.build_param(param::MyFreq, p)
    return param.a + p.Fr / p.F0
end</code></pre><p>which says that the depends changes as a function of frequency linearly with a slope of <code>F0</code> and a intercept of <code>a</code>. This can be used as follows</p><pre><code class="language-julia hljs">ν₀ = 230e9
σ₀ = 1.0
size = MyFreq(1.0, ν₀)
gauss = MyGaussian(size)</code></pre><div class="admonition is-info" id="Note-b1182b894274c899"><header class="admonition-header">Note<a class="admonition-anchor" href="#Note-b1182b894274c899" title="Permalink"></a></header><div class="admonition-body"><p>This extension of the model to be time and frequency dependent is only necessary for models that aren&#39;t intrinsically dependent on time and frequency. For a model, that has some prescribed time and frequency dependence, the model should be defined explicitly in <code>intensity_point</code>/<code>visibility_point</code> if they are analytic in the image/visibility domain respectively.</p></div></div></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Home</a><a class="docs-footer-nextpage" href="../api/">API »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Tuesday 25 November 2025 14:24">Tuesday 25 November 2025</span>. Using Julia version 1.10.10.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
